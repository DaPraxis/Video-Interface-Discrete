const FACES = {
  fearful: [
    "_006_m_f_f_a_FEARFUL",
    "_011_m_f_f_a_FEARFUL",
    "_019_m_f_f_a_FEARFUL",
    "_029_m_f_f_a_FEARFUL",
    "_035_m_f_f_a_FEARFUL",
    "_043_m_f_f_a_FEARFUL",
    "_050_m_f_f_a_FEARFUL",
    "_052_m_f_f_a_FEARFUL",
    "_061_m_f_f_a_FEARFUL",
    "_064_m_f_f_a_FEARFUL",
    "_073_m_f_f_a_FEARFUL",
    "_080_m_f_f_a_FEARFUL",
    "_084_m_f_f_a_FEARFUL",
    "_093_m_f_f_a_FEARFUL",
    "_097_m_f_f_a_FEARFUL",
    "_103_m_f_f_a_FEARFUL",
    "_111_m_f_f_a_FEARFUL",
    "_113_m_f_f_a_FEARFUL",
    "_117_m_f_f_a_FEARFUL",
    "_122_m_f_f_a_FEARFUL",
    "_128_m_f_f_a_FEARFUL",
    "_138_m_f_f_a_FEARFUL",
    "_139_m_f_f_a_FEARFUL",
    "_156_m_f_f_a_FEARFUL",
    "_157_m_f_f_a_FEARFUL",
    "_168_m_f_f_a_FEARFUL",
    "_180_m_f_f_a_FEARFUL",
    "_026_m_m_f_a_FEARFUL",
    "_032_m_m_f_a_FEARFUL",
    "_038_m_m_f_a_FEARFUL",
    "_051_m_m_f_a_FEARFUL",
    "_058_m_m_f_a_FEARFUL",
    "_070_m_m_f_a_FEARFUL",
    "_082_m_m_f_a_FEARFUL",
    "_087_m_m_f_a_FEARFUL",
    "_092_m_m_f_a_FEARFUL",
    "_094_m_m_f_a_FEARFUL",
    "_104_m_m_f_a_FEARFUL",
    "_108_m_m_f_a_FEARFUL",
    "_126_m_m_f_a_FEARFUL",
    "_136_m_m_f_a_FEARFUL",
    "_149_m_m_f_a_FEARFUL",
    "_155_m_m_f_a_FEARFUL",
    "_159_m_m_f_a_FEARFUL",
    "_178_m_m_f_a_FEARFUL",
    "_010_y_f_f_a_FEARFUL",
    "_020_y_f_f_a_FEARFUL",
    "_022_y_f_f_a_FEARFUL",
    "_028_y_f_f_a_FEARFUL",
    "_034_y_f_f_a_FEARFUL",
    "_040_y_f_f_a_FEARFUL",
    "_048_y_f_f_a_FEARFUL",
    "_054_y_f_f_a_FEARFUL",
    "_063_y_f_f_a_FEARFUL",
    "_069_y_f_f_a_FEARFUL",
    "_071_y_f_f_a_FEARFUL",
    "_085_y_f_f_a_FEARFUL",
    "_090_y_f_f_a_FEARFUL",
    "_098_y_f_f_a_FEARFUL",
    "_101_y_f_f_a_FEARFUL",
    "_106_y_f_f_a_FEARFUL",
    "_125_y_f_f_a_FEARFUL",
    "_134_y_f_f_a_FEARFUL",
    "_140_y_f_f_a_FEARFUL",
    "_150_y_f_f_a_FEARFUL",
    "_152_y_f_f_a_FEARFUL",
    "_162_y_f_f_a_FEARFUL",
    "_163_y_f_f_a_FEARFUL",
    "_171_y_f_f_a_FEARFUL",
    "_173_y_f_f_a_FEARFUL",
    "_177_y_f_f_a_FEARFUL",
    "_182_y_f_f_a_FEARFUL",
    "_008_y_m_f_a_FEARFUL",
    "_013_y_m_f_a_FEARFUL",
    "_016_y_m_f_a_FEARFUL",
    "_025_y_m_f_a_FEARFUL",
    "_031_y_m_f_a_FEARFUL",
    "_037_y_m_f_a_FEARFUL",
    "_041_y_m_f_a_FEARFUL",
    "_049_y_m_f_a_FEARFUL",
    "_057_y_m_f_a_FEARFUL",
    "_062_y_m_f_a_FEARFUL",
    "_066_y_m_f_a_FEARFUL",
    "_072_y_m_f_a_FEARFUL",
    "_081_y_m_f_a_FEARFUL",
    "_099_y_m_f_a_FEARFUL",
    "_105_y_m_f_a_FEARFUL",
    "_109_y_m_f_a_FEARFUL",
    "_114_y_m_f_a_FEARFUL",
    "_119_y_m_f_a_FEARFUL",
    "_123_y_m_f_a_FEARFUL",
    "_127_y_m_f_a_FEARFUL",
    "_135_y_m_f_a_FEARFUL",
    "_144_y_m_f_a_FEARFUL",
    "_147_y_m_f_a_FEARFUL",
    "_153_y_m_f_a_FEARFUL",
    "_160_y_m_f_a_FEARFUL",
    "_167_y_m_f_a_FEARFUL",
    "_170_y_m_f_a_FEARFUL",
    "_175_y_m_f_a_FEARFUL",
  ],
  happy: [
    "_006_m_f_h_a_HAPPY",
    "_011_m_f_h_a_HAPPY",
    "_019_m_f_h_a_HAPPY",
    "_029_m_f_h_a_HAPPY",
    "_035_m_f_h_a_HAPPY",
    "_043_m_f_h_a_HAPPY",
    "_050_m_f_h_a_HAPPY",
    "_052_m_f_h_a_HAPPY",
    "_061_m_f_h_a_HAPPY",
    "_064_m_f_h_a_HAPPY",
    "_073_m_f_h_a_HAPPY",
    "_080_m_f_h_a_HAPPY",
    "_084_m_f_h_a_HAPPY",
    "_093_m_f_h_a_HAPPY",
    "_097_m_f_h_a_HAPPY",
    "_103_m_f_h_a_HAPPY",
    "_111_m_f_h_a_HAPPY",
    "_113_m_f_h_a_HAPPY",
    "_117_m_f_h_a_HAPPY",
    "_122_m_f_h_a_HAPPY",
    "_128_m_f_h_a_HAPPY",
    "_138_m_f_h_a_HAPPY",
    "_139_m_f_h_a_HAPPY",
    "_157_m_f_h_a_HAPPY",
    "_168_m_f_h_a_HAPPY",
    "_180_m_f_h_a_HAPPY",
    "_007_m_m_h_a_HAPPY",
    "_014_m_m_h_a_HAPPY",
    "_026_m_m_h_a_HAPPY",
    "_038_m_m_h_a_HAPPY",
    "_045_m_m_h_a_HAPPY",
    "_051_m_m_h_a_HAPPY",
    "_056_m_m_h_a_HAPPY",
    "_058_m_m_h_a_HAPPY",
    "_068_m_m_h_a_HAPPY",
    "_077_m_m_h_a_HAPPY",
    "_082_m_m_h_a_HAPPY",
    "_087_m_m_h_a_HAPPY",
    "_092_m_m_h_a_HAPPY",
    "_104_m_m_h_a_HAPPY",
    "_108_m_m_h_a_HAPPY",
    "_116_m_m_h_a_HAPPY",
    "_126_m_m_h_a_HAPPY",
    "_136_m_m_h_a_HAPPY",
    "_142_m_m_h_a_HAPPY",
    "_165_m_m_h_a_HAPPY",
    "_169_m_m_h_a_HAPPY",
    "_178_m_m_h_a_HAPPY",
    "_179_m_m_h_a_HAPPY",
    "_020_y_f_h_a_HAPPY",
    "_022_y_f_h_a_HAPPY",
    "_028_y_f_h_a_HAPPY",
    "_034_y_f_h_a_HAPPY",
    "_040_y_f_h_a_HAPPY",
    "_048_y_f_h_a_HAPPY",
    "_054_y_f_h_a_HAPPY",
    "_063_y_f_h_a_HAPPY",
    "_071_y_f_h_a_HAPPY",
    "_085_y_f_h_a_HAPPY",
    "_090_y_f_h_a_HAPPY",
    "_101_y_f_h_a_HAPPY",
    "_106_y_f_h_a_HAPPY",
    "_115_y_f_h_a_HAPPY",
    "_132_y_f_h_a_HAPPY",
    "_134_y_f_h_a_HAPPY",
    "_140_y_f_h_a_HAPPY",
    "_152_y_f_h_a_HAPPY",
    "_163_y_f_h_a_HAPPY",
    "_171_y_f_h_a_HAPPY",
    "_173_y_f_h_a_HAPPY",
    "_182_y_f_h_a_HAPPY",
    "_008_y_m_h_a_HAPPY",
    "_013_y_m_h_a_HAPPY",
    "_016_y_m_h_a_HAPPY",
    "_025_y_m_h_a_HAPPY",
    "_031_y_m_h_a_HAPPY",
    "_037_y_m_h_a_HAPPY",
    "_041_y_m_h_a_HAPPY",
    "_049_y_m_h_a_HAPPY",
    "_057_y_m_h_a_HAPPY",
    "_062_y_m_h_a_HAPPY",
    "_066_y_m_h_a_HAPPY",
    "_072_y_m_h_a_HAPPY",
    "_081_y_m_h_a_HAPPY",
    "_089_y_m_h_a_HAPPY",
    "_099_y_m_h_a_HAPPY",
    "_105_y_m_h_a_HAPPY",
    "_109_y_m_h_a_HAPPY",
    "_114_y_m_h_a_HAPPY",
    "_119_y_m_h_a_HAPPY",
    "_123_y_m_h_a_HAPPY",
    "_127_y_m_h_a_HAPPY",
    "_135_y_m_h_a_HAPPY",
    "_144_y_m_h_a_HAPPY",
    "_147_y_m_h_a_HAPPY",
    "_153_y_m_h_a_HAPPY",
    "_160_y_m_h_a_HAPPY",
    "_167_y_m_h_a_HAPPY",
    "_170_y_m_h_a_HAPPY",
    "_175_y_m_h_a_HAPPY",
  ],
  neutral: [
    "_006_m_f_n_a_NEUTRAL",
    "_011_m_f_n_a_NEUTRAL",
    "_019_m_f_n_a_NEUTRAL",
    "_029_m_f_n_a_NEUTRAL",
    "_035_m_f_n_a_NEUTRAL",
    "_043_m_f_n_a_NEUTRAL",
    "_050_m_f_n_a_NEUTRAL",
    "_052_m_f_n_a_NEUTRAL",
    "_061_m_f_n_a_NEUTRAL",
    "_064_m_f_n_a_NEUTRAL",
    "_073_m_f_n_a_NEUTRAL",
    "_080_m_f_n_a_NEUTRAL",
    "_084_m_f_n_a_NEUTRAL",
    "_093_m_f_n_a_NEUTRAL",
    "_097_m_f_n_a_NEUTRAL",
    "_103_m_f_n_a_NEUTRAL",
    "_113_m_f_n_a_NEUTRAL",
    "_117_m_f_n_a_NEUTRAL",
    "_122_m_f_n_a_NEUTRAL",
    "_128_m_f_n_a_NEUTRAL",
    "_138_m_f_n_a_NEUTRAL",
    "_139_m_f_n_a_NEUTRAL",
    "_156_m_f_n_a_NEUTRAL",
    "_157_m_f_n_a_NEUTRAL",
    "_168_m_f_n_a_NEUTRAL",
    "_007_m_m_n_a_NEUTRAL",
    "_014_m_m_n_a_NEUTRAL",
    "_026_m_m_n_a_NEUTRAL",
    "_038_m_m_n_a_NEUTRAL",
    "_045_m_m_n_a_NEUTRAL",
    "_051_m_m_n_a_NEUTRAL",
    "_056_m_m_n_a_NEUTRAL",
    "_058_m_m_n_a_NEUTRAL",
    "_068_m_m_n_a_NEUTRAL",
    "_077_m_m_n_a_NEUTRAL",
    "_082_m_m_n_a_NEUTRAL",
    "_087_m_m_n_a_NEUTRAL",
    "_092_m_m_n_a_NEUTRAL",
    "_104_m_m_n_a_NEUTRAL",
    "_116_m_m_n_a_NEUTRAL",
    "_136_m_m_n_a_NEUTRAL",
    "_142_m_m_n_a_NEUTRAL",
    "_165_m_m_n_a_NEUTRAL",
    "_169_m_m_n_a_NEUTRAL",
    "_179_m_m_n_a_NEUTRAL",
    "_010_y_f_n_a_NEUTRAL",
    "_020_y_f_n_a_NEUTRAL",
    "_022_y_f_n_a_NEUTRAL",
    "_028_y_f_n_a_NEUTRAL",
    "_034_y_f_n_a_NEUTRAL",
    "_040_y_f_n_a_NEUTRAL",
    "_048_y_f_n_a_NEUTRAL",
    "_054_y_f_n_a_NEUTRAL",
    "_063_y_f_n_a_NEUTRAL",
    "_071_y_f_n_a_NEUTRAL",
    "_085_y_f_n_a_NEUTRAL",
    "_090_y_f_n_a_NEUTRAL",
    "_098_y_f_n_a_NEUTRAL",
    "_101_y_f_n_a_NEUTRAL",
    "_106_y_f_n_a_NEUTRAL",
    "_115_y_f_n_a_NEUTRAL",
    "_132_y_f_n_a_NEUTRAL",
    "_134_y_f_n_a_NEUTRAL",
    "_140_y_f_n_a_NEUTRAL",
    "_150_y_f_n_a_NEUTRAL",
    "_152_y_f_n_a_NEUTRAL",
    "_162_y_f_n_a_NEUTRAL",
    "_163_y_f_n_a_NEUTRAL",
    "_171_y_f_n_a_NEUTRAL",
    "_173_y_f_n_a_NEUTRAL",
    "_177_y_f_n_a_NEUTRAL",
    "_182_y_f_n_a_NEUTRAL",
    "_008_y_m_n_a_NEUTRAL",
    "_013_y_m_n_a_NEUTRAL",
    "_016_y_m_n_a_NEUTRAL",
    "_025_y_m_n_a_NEUTRAL",
    "_031_y_m_n_a_NEUTRAL",
    "_037_y_m_n_a_NEUTRAL",
    "_041_y_m_n_a_NEUTRAL",
    "_049_y_m_n_a_NEUTRAL",
    "_057_y_m_n_a_NEUTRAL",
    "_062_y_m_n_a_NEUTRAL",
    "_066_y_m_n_a_NEUTRAL",
    "_072_y_m_n_a_NEUTRAL",
    "_081_y_m_n_a_NEUTRAL",
    "_089_y_m_n_a_NEUTRAL",
    "_099_y_m_n_a_NEUTRAL",
    "_105_y_m_n_a_NEUTRAL",
    "_109_y_m_n_a_NEUTRAL",
    "_119_y_m_n_a_NEUTRAL",
    "_123_y_m_n_a_NEUTRAL",
    "_127_y_m_n_a_NEUTRAL",
    "_135_y_m_n_a_NEUTRAL",
    "_144_y_m_n_a_NEUTRAL",
    "_147_y_m_n_a_NEUTRAL",
    "_153_y_m_n_a_NEUTRAL",
    "_160_y_m_n_a_NEUTRAL",
    "_167_y_m_n_a_NEUTRAL",
    "_170_y_m_n_a_NEUTRAL",
    "_175_y_m_n_a_NEUTRAL",
  ],
};

const COPY = { neutral: [], fearful: [], happy: [] };

function getFace(expression) {
  if (COPY[expression].length === 0) {
    COPY[expression] = FACES[expression]
      .map((face) => ({
        key: Math.random(),
        value: face,
      }))
      .sort((x, y) => x.key - y.key)
      .map((face) => face.value);
  }
  return COPY[expression].pop();
}

export default function createTrials(n, numHoles, version) {
  const trials = [];
  if ((n / 6) % 2 === 0) {
    // equally create each type of stimuli
    if (version === "baseline") {
      for (let i = 0; i < n / 2; i++) {
        trials.push({ expressions: ["neutral"], holes: [], faces: [] });
        trials.push({ expressions: ["happy"], holes: [], faces: [] });
      }
    } else if (version === "all") {
      for (let i = 0; i < n / 3; i++) {
        trials.push({ expressions: ["neutral"], holes: [], faces: [] });
        trials.push({ expressions: ["fearful"], holes: [], faces: [] });
        trials.push({ expressions: ["happy"], holes: [], faces: [] });
      }
    } else {
      for (let i = 0; i < n / 6; i++) {
        trials.push({ expressions: ["neutral"], holes: [], faces: [] });
        trials.push({ expressions: ["fearful"], holes: [], faces: [] });
        trials.push({ expressions: ["happy"], holes: [], faces: [] });
        trials.push({
          expressions: ["neutral", "fearful"],
          holes: [],
          faces: [],
        });
        trials.push({
          expressions: ["happy", "neutral"],
          holes: [],
          faces: [],
        });
        trials.push({
          expressions: ["fearful", "happy"],
          holes: [],
          faces: [],
        });
      }
    }
  } else {
    // randomly create each type of stimuli
    for (let i = 0; i < n; i++) {
      if (version === "baseline") {
        trials.push({
          expressions: [["neutral"], ["happy"]][Math.floor(Math.random() * 2)],
          holes: [],
          faces: [],
        });
      } else if (version === "all") {
        trials.push({
          expressions: [["neutral"], ["fearful"], ["happy"]][
            Math.floor(Math.random() * 3)
          ],
          holes: [],
          faces: [],
        });
      } else {
        trials.push({
          expressions: [
            ["neutral"],
            ["fearful"],
            ["happy"],
            ["neutral", "fearful"],
            ["happy", "neutral"],
            ["fearful", "happy"],
          ][Math.floor(Math.random() * 6)],
          holes: [],
          faces: [],
        });
      }
    }
  }

  // randomize holes and faces
  for (let i = 0; i < n; i++) {
    for (let j = 0; j < trials[i].expressions.length; j++) {
      let hole;
      do {
        hole = Math.floor(Math.random() * numHoles);
      } while (trials[i].holes.includes(hole));
      trials[i].holes.push(hole);
      trials[i].faces.push(getFace(trials[i].expressions[j]));
    }
  }

  // randomize order
  return trials
    .map((trial) => ({
      key: Math.random(),
      value: trial,
    }))
    .sort((x, y) => x.key - y.key)
    .map((trial) => trial.value);
}
